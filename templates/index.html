<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MapVisual - US Mobile Subscribers Visualization</title>
    
    <!-- Glassmorphism CSS -->
    <link rel="stylesheet" href="/static/css/glassmorphism.css">
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <!-- Header -->
    <div class="header">
        <h1>MapVisual Engine</h1>
        <p>Interactive US Mobile Subscribers Visualization</p>
    </div>
    
    <!-- Stats Panel -->
    <div class="stats-panel">
        <div class="glass-container stats-grid fade-in">
            <div class="stat-card">
                <div class="stat-value" id="stat-total">-</div>
                <div class="stat-label">Total Subscribers</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="stat-states">-</div>
                <div class="stat-label">States Covered</div>
            </div>
            <div class="stat-card">
                <div class="stat-value">3</div>
                <div class="stat-label">Major Carriers</div>
            </div>
        </div>
    </div>
    
    <!-- Controls Section -->
    <div class="controls-section">
        <div class="glass-container controls-grid fade-in">
            <div class="control-group">
                <label class="control-label" for="metric-select">Select Metric</label>
                <select id="metric-select">
                    <option value="total_subscribers">Total Mobile (T)</option>
                    <option value="total_prepaid">Total (Pre)</option>
                    <option value="total_postpaid">Total (Post)</option>
                    <option value="verizon_total">Verizon (T)</option>
                    <option value="verizon_prepaid">Verizon (Pre)</option>
                    <option value="verizon_postpaid">Verizon (Post)</option>
                    <option value="tmobile_total">T-Mobile (T)</option>
                    <option value="tmobile_prepaid">T-Mobile (Pre)</option>
                    <option value="tmobile_postpaid">T-Mobile (Post)</option>
                    <option value="att_total">AT&amp;T (T)</option>
                    <option value="att_prepaid">AT&amp;T (Pre)</option>
                    <option value="att_postpaid">AT&amp;T (Post)</option>
                    <option value="others_total">Others (T)</option>
                    <option value="others_prepaid">Others (Pre)</option>
                    <option value="others_postpaid">Others (Post)</option>
                </select>
            </div>
            
            <div class="control-group">
                <label class="control-label">Map Controls</label>
                <button id="reset-zoom">Reset Zoom</button>
            </div>
        </div>
    </div>
    
    <!-- Map Container -->
    <div class="map-container">
        <div class="glass-container fade-in">
            <div id="map-svg-container">
                <div class="loading">
                    <div class="spinner"></div>
                    <span>Loading visualization...</span>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Legend -->
    <div class="legend">
        <div class="glass-panel fade-in">
            <div class="legend-title">Color Scale</div>
            <div class="legend-scale" id="legend-scale"></div>
            <div class="legend-labels">
                <span id="legend-min">Min</span>
                <span id="legend-max">Max</span>
            </div>
        </div>
    </div>
    
    <!-- D3.js and TopoJSON - Local files with CDN fallback -->
    <script src="{{ url_for('static', filename='js/d3.min.js') }}"></script>
    <script src="{{ url_for('static', filename='js/topojson.min.js') }}"></script>

    <!-- Fallback loader for D3.js if local fails -->
    <script>
        if (typeof d3 === 'undefined') {
            console.warn('Local D3.js failed, trying CDN fallback...');
            document.write('<script src="https://unpkg.com/d3@7/dist/d3.min.js"><\/script>');
        }
    </script>

    <!-- Fallback loader for TopoJSON if local fails -->
    <script>
        if (typeof topojson === 'undefined') {
            console.warn('Local TopoJSON failed, trying CDN fallback...');
            document.write('<script src="https://unpkg.com/topojson@3/dist/topojson.min.js"><\/script>');
        }
    </script>

    <!-- Verification script -->
    <script>
        window.addEventListener('load', function() {
            if (typeof d3 !== 'undefined') {
                console.log('✓ D3.js loaded successfully (version: ' + d3.version + ')');
            } else {
                console.error('✗ D3.js failed to load from all sources');
            }
            
            if (typeof topojson !== 'undefined') {
                console.log('✓ TopoJSON loaded successfully');
            } else {
                console.error('✗ TopoJSON failed to load from all sources');
            }
        });
    </script>
    
    <!-- Fallback visualization -->
    <script src="/static/js/fallback_viz.js"></script>
    
    <!-- Map Visualization Script -->
    <script src="/static/js/map_semantic_zoom.js"></script>
    
    <!-- Fallback message if libraries don't load -->
    <script>
        window.addEventListener('DOMContentLoaded', function() {
            setTimeout(function() {
                if (typeof d3 === 'undefined') {
                    console.error('D3.js is not available, using fallback visualization');
                    createFallbackVisualization();
                }
            }, 2000);
        });
    </script>
</body>
</html>
